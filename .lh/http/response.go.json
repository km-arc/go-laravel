{
    "sourceFile": "http/response.go",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1772220531051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1772220531051,
            "name": "Commit-0",
            "content": "package http\n\nimport (\n\t\"encoding/json\"\n\t\"html/template\"\n\t\"net/http\"\n\t\"path/filepath\"\n\n\t\"github.com/km-arc/go-laravel/http/validation\"\n)\n\n// ── Response ─────────────────────────────────────────────────────────────────\n\n// Response wraps http.ResponseWriter with Laravel-style helpers.\ntype Response struct {\n\tw http.ResponseWriter\n}\n\n// NewResponse wraps a ResponseWriter.\nfunc NewResponse(w http.ResponseWriter) *Response {\n\treturn &Response{w: w}\n}\n\n// Raw returns the underlying ResponseWriter.\nfunc (res *Response) Raw() http.ResponseWriter { return res.w }\n\n// ── JSON responses ────────────────────────────────────────────────────────────\n\n// JSON sends a JSON response.\n//\n//\tres.JSON(http.StatusOK, map[string]any{\"message\": \"ok\"})\nfunc (res *Response) JSON(status int, data any) {\n\tres.w.Header().Set(\"Content-Type\", \"application/json\")\n\tres.w.WriteHeader(status)\n\t_ = json.NewEncoder(res.w).Encode(data)\n}\n\n// Success sends 200 JSON: {\"data\": v}\nfunc (res *Response) Success(v any) {\n\tres.JSON(http.StatusOK, envelope{\"data\": v})\n}\n\n// Created sends 201 JSON: {\"data\": v}\nfunc (res *Response) Created(v any) {\n\tres.JSON(http.StatusCreated, envelope{\"data\": v})\n}\n\n// NoContent sends 204 with no body.\nfunc (res *Response) NoContent() {\n\tres.w.WriteHeader(http.StatusNoContent)\n}\n\n// Error sends a JSON error response.\n//\n//\tres.Error(http.StatusNotFound, \"Resource not found\")\nfunc (res *Response) Error(status int, message string) {\n\tres.JSON(status, envelope{\"message\": message})\n}\n\n// Unauthorized sends 401.\nfunc (res *Response) Unauthorized(message ...string) {\n\tmsg := first(message, \"Unauthenticated.\")\n\tres.JSON(http.StatusUnauthorized, envelope{\"message\": msg})\n}\n\n// Forbidden sends 403.\nfunc (res *Response) Forbidden(message ...string) {\n\tmsg := first(message, \"This action is unauthorized.\")\n\tres.JSON(http.StatusForbidden, envelope{\"message\": msg})\n}\n\n// NotFound sends 404.\nfunc (res *Response) NotFound(message ...string) {\n\tmsg := first(message, \"Not found.\")\n\tres.JSON(http.StatusNotFound, envelope{\"message\": msg})\n}\n\n// ServerError sends 500.\nfunc (res *Response) ServerError(message ...string) {\n\tmsg := first(message, \"Server Error.\")\n\tres.JSON(http.StatusInternalServerError, envelope{\"message\": msg})\n}\n\n// ValidationError sends 422 with the standard Laravel error bag.\n//\n//\tres.ValidationError(validator.Errors())\nfunc (res *Response) ValidationError(errors *validation.Errors) {\n\tres.JSON(http.StatusUnprocessableEntity, errors)\n}\n\n// ── Redirects ────────────────────────────────────────────────────────────────\n\n// Redirect performs an HTTP redirect.\n//\n//\tres.Redirect(http.StatusFound, \"/dashboard\")\nfunc (res *Response) Redirect(status int, url string) {\n\thttp.Redirect(res.w, &http.Request{}, url, status)\n}\n\n// RedirectTo performs a 302 redirect.\nfunc (res *Response) RedirectTo(url string) {\n\tres.w.Header().Set(\"Location\", url)\n\tres.w.WriteHeader(http.StatusFound)\n}\n\n// RedirectBack redirects to the Referer header (or fallback URL).\nfunc (res *Response) RedirectBack(r *http.Request, fallback string) {\n\tref := r.Referer()\n\tif ref == \"\" {\n\t\tref = fallback\n\t}\n\tres.w.Header().Set(\"Location\", ref)\n\tres.w.WriteHeader(http.StatusFound)\n}\n\n// ── View / Templates ─────────────────────────────────────────────────────────\n\n// ViewEngine holds a compiled template set.\ntype ViewEngine struct {\n\tdir string\n\text string\n}\n\n// NewViewEngine creates a ViewEngine.\n// dir is the templates directory (e.g. \"./views\"), ext is the file extension (e.g. \".html\").\nfunc NewViewEngine(dir, ext string) *ViewEngine {\n\treturn &ViewEngine{dir: dir, ext: ext}\n}\n\n// View renders a template file with data.\n//\n//\tengine.View(res.Raw(), \"home\", map[string]any{\"title\": \"Home\"})\nfunc (ve *ViewEngine) View(w http.ResponseWriter, name string, data any) {\n\tpattern := filepath.Join(ve.dir, name+ve.ext)\n\ttmpl, err := template.ParseFiles(pattern)\n\tif err != nil {\n\t\thttp.Error(w, \"Template not found: \"+name, http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\tif err := tmpl.Execute(w, data); err != nil {\n\t\thttp.Error(w, \"Template render error\", http.StatusInternalServerError)\n\t}\n}\n\n// ViewWithLayout renders a template with a base layout.\nfunc (ve *ViewEngine) ViewWithLayout(w http.ResponseWriter, layout, name string, data any) {\n\tlayoutPath := filepath.Join(ve.dir, layout+ve.ext)\n\tviewPath := filepath.Join(ve.dir, name+ve.ext)\n\ttmpl, err := template.ParseFiles(layoutPath, viewPath)\n\tif err != nil {\n\t\thttp.Error(w, \"Template error: \"+err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\tw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\tif err := tmpl.ExecuteTemplate(w, filepath.Base(layoutPath), data); err != nil {\n\t\thttp.Error(w, \"Render error: \"+err.Error(), http.StatusInternalServerError)\n\t}\n}\n\n// ── Helpers ──────────────────────────────────────────────────────────────────\n\ntype envelope map[string]any\n\nfunc first(ss []string, fallback string) string {\n\tif len(ss) > 0 && ss[0] != \"\" {\n\t\treturn ss[0]\n\t}\n\treturn fallback\n}\n"
        }
    ]
}