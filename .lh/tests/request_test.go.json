{
    "sourceFile": "tests/request_test.go",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1772220531309,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1772220531309,
            "name": "Commit-0",
            "content": "package http_test\n\nimport (\n\t\"bytes\"\n\t\"mime/multipart\"\n\t\"net/http\"\n\t\"net/http/httptest\"\n\t\"net/url\"\n\t\"strings\"\n\t\"testing\"\n\n\tgohttp \"github.com/km-arc/go-laravel/http\"\n)\n\n// ── helpers ──────────────────────────────────────────────────────────────────\n\nfunc newJSONRequest(t *testing.T, body string) *gohttp.Request {\n\tt.Helper()\n\treq := httptest.NewRequest(http.MethodPost, \"/\", strings.NewReader(body))\n\treq.Header.Set(\"Content-Type\", \"application/json\")\n\treturn gohttp.NewRequest(req)\n}\n\nfunc newFormRequest(t *testing.T, values url.Values) *gohttp.Request {\n\tt.Helper()\n\treq := httptest.NewRequest(http.MethodPost, \"/\", strings.NewReader(values.Encode()))\n\treq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\treturn gohttp.NewRequest(req)\n}\n\nfunc newGetRequest(t *testing.T, rawQuery string) *gohttp.Request {\n\tt.Helper()\n\treq := httptest.NewRequest(http.MethodGet, \"/?\"+rawQuery, nil)\n\treturn gohttp.NewRequest(req)\n}\n\n// ── Bind JSON ────────────────────────────────────────────────────────────────\n\nfunc TestRequest_BindJSON(t *testing.T) {\n\ttype user struct {\n\t\tName  string `json:\"name\"`\n\t\tEmail string `json:\"email\"`\n\t}\n\n\treq := newJSONRequest(t, `{\"name\":\"Alice\",\"email\":\"alice@example.com\"}`)\n\n\tvar u user\n\tif err := req.Bind(&u); err != nil {\n\t\tt.Fatalf(\"Bind error: %v\", err)\n\t}\n\tif u.Name != \"Alice\" {\n\t\tt.Errorf(\"Name: got %q want %q\", u.Name, \"Alice\")\n\t}\n\tif u.Email != \"alice@example.com\" {\n\t\tt.Errorf(\"Email: got %q want %q\", u.Email, \"alice@example.com\")\n\t}\n}\n\nfunc TestRequest_BindJSON_EmptyBody(t *testing.T) {\n\treq := httptest.NewRequest(http.MethodPost, \"/\", strings.NewReader(\"\"))\n\treq.Header.Set(\"Content-Type\", \"application/json\")\n\tr := gohttp.NewRequest(req)\n\n\tvar v any\n\terr := r.Bind(&v)\n\tif err == nil {\n\t\tt.Error(\"expected error for empty body, got nil\")\n\t}\n}\n\nfunc TestRequest_BindJSON_InvalidJSON(t *testing.T) {\n\treq := newJSONRequest(t, `{bad json}`)\n\tvar v map[string]any\n\tif err := req.Bind(&v); err == nil {\n\t\tt.Error(\"expected error for invalid JSON\")\n\t}\n}\n\n// ── Bind Form ────────────────────────────────────────────────────────────────\n\nfunc TestRequest_BindForm(t *testing.T) {\n\ttype payload struct {\n\t\tName string `json:\"name\"`\n\t}\n\n\tvals := url.Values{\"name\": {\"Bob\"}}\n\treq := newFormRequest(t, vals)\n\n\tvar p payload\n\tif err := req.Bind(&p); err != nil {\n\t\tt.Fatalf(\"Bind form error: %v\", err)\n\t}\n\tif p.Name != \"Bob\" {\n\t\tt.Errorf(\"Name: got %q want %q\", p.Name, \"Bob\")\n\t}\n}\n\n// ── Input / Query ─────────────────────────────────────────────────────────────\n\nfunc TestRequest_Input(t *testing.T) {\n\tvals := url.Values{\"username\": {\"charlie\"}}\n\treq := newFormRequest(t, vals)\n\n\tif got := req.Input(\"username\"); got != \"charlie\" {\n\t\tt.Errorf(\"Input: got %q want %q\", got, \"charlie\")\n\t}\n}\n\nfunc TestRequest_Input_Fallback(t *testing.T) {\n\treq := newGetRequest(t, \"\")\n\tif got := req.Input(\"missing\", \"default\"); got != \"default\" {\n\t\tt.Errorf(\"Input fallback: got %q want %q\", got, \"default\")\n\t}\n}\n\nfunc TestRequest_Query(t *testing.T) {\n\treq := newGetRequest(t, \"page=2&limit=10\")\n\n\tif got := req.Query(\"page\"); got != \"2\" {\n\t\tt.Errorf(\"Query page: got %q want %q\", got, \"2\")\n\t}\n\tif got := req.Query(\"limit\"); got != \"10\" {\n\t\tt.Errorf(\"Query limit: got %q want %q\", got, \"10\")\n\t}\n}\n\nfunc TestRequest_Query_Fallback(t *testing.T) {\n\treq := newGetRequest(t, \"\")\n\tif got := req.Query(\"missing\", \"1\"); got != \"1\" {\n\t\tt.Errorf(\"Query fallback: got %q want %q\", got, \"1\")\n\t}\n}\n\nfunc TestRequest_All(t *testing.T) {\n\tvals := url.Values{\"a\": {\"1\"}, \"b\": {\"2\"}}\n\treq := newFormRequest(t, vals)\n\tall := req.All()\n\n\tif all[\"a\"] != \"1\" {\n\t\tt.Errorf(\"All[a]: got %q want %q\", all[\"a\"], \"1\")\n\t}\n\tif all[\"b\"] != \"2\" {\n\t\tt.Errorf(\"All[b]: got %q want %q\", all[\"b\"], \"2\")\n\t}\n}\n\nfunc TestRequest_Has(t *testing.T) {\n\tvals := url.Values{\"name\": {\"Alice\"}, \"empty\": {\"\"}}\n\treq := newFormRequest(t, vals)\n\n\tif !req.Has(\"name\") {\n\t\tt.Error(\"Has('name') should be true\")\n\t}\n\tif req.Has(\"empty\") {\n\t\tt.Error(\"Has('empty') should be false for blank value\")\n\t}\n\tif req.Has(\"missing\") {\n\t\tt.Error(\"Has('missing') should be false\")\n\t}\n}\n\n// ── Headers / Auth ────────────────────────────────────────────────────────────\n\nfunc TestRequest_Header(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodGet, \"/\", nil)\n\tr.Header.Set(\"X-Custom\", \"value123\")\n\treq := gohttp.NewRequest(r)\n\n\tif got := req.Header(\"X-Custom\"); got != \"value123\" {\n\t\tt.Errorf(\"Header: got %q want %q\", got, \"value123\")\n\t}\n}\n\nfunc TestRequest_BearerToken(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodGet, \"/\", nil)\n\tr.Header.Set(\"Authorization\", \"Bearer my-secret-token\")\n\treq := gohttp.NewRequest(r)\n\n\tif got := req.BearerToken(); got != \"my-secret-token\" {\n\t\tt.Errorf(\"BearerToken: got %q want %q\", got, \"my-secret-token\")\n\t}\n}\n\nfunc TestRequest_BearerToken_Missing(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodGet, \"/\", nil)\n\treq := gohttp.NewRequest(r)\n\n\tif got := req.BearerToken(); got != \"\" {\n\t\tt.Errorf(\"BearerToken should be empty, got %q\", got)\n\t}\n}\n\n// ── IsJSON ────────────────────────────────────────────────────────────────────\n\nfunc TestRequest_IsJSON_ContentType(t *testing.T) {\n\treq := newJSONRequest(t, `{}`)\n\tif !req.IsJSON() {\n\t\tt.Error(\"IsJSON should be true when Content-Type is application/json\")\n\t}\n}\n\nfunc TestRequest_IsJSON_Accept(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodGet, \"/\", nil)\n\tr.Header.Set(\"Accept\", \"application/json\")\n\treq := gohttp.NewRequest(r)\n\tif !req.IsJSON() {\n\t\tt.Error(\"IsJSON should be true when Accept is application/json\")\n\t}\n}\n\n// ── Method / Path ─────────────────────────────────────────────────────────────\n\nfunc TestRequest_Method(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodDelete, \"/resource/1\", nil)\n\treq := gohttp.NewRequest(r)\n\tif req.Method() != http.MethodDelete {\n\t\tt.Errorf(\"Method: got %q want DELETE\", req.Method())\n\t}\n}\n\nfunc TestRequest_Path(t *testing.T) {\n\tr := httptest.NewRequest(http.MethodGet, \"/api/v1/users\", nil)\n\treq := gohttp.NewRequest(r)\n\tif req.Path() != \"/api/v1/users\" {\n\t\tt.Errorf(\"Path: got %q want /api/v1/users\", req.Path())\n\t}\n}\n\n// ── Multipart file upload ─────────────────────────────────────────────────────\n\nfunc TestRequest_File(t *testing.T) {\n\tvar buf bytes.Buffer\n\tw := multipart.NewWriter(&buf)\n\tfw, err := w.CreateFormFile(\"avatar\", \"avatar.png\")\n\tif err != nil {\n\t\tt.Fatal(err)\n\t}\n\t_, _ = fw.Write([]byte(\"fake-image-data\"))\n\t_ = w.Close()\n\n\tr := httptest.NewRequest(http.MethodPost, \"/\", &buf)\n\tr.Header.Set(\"Content-Type\", w.FormDataContentType())\n\treq := gohttp.NewRequest(r)\n\n\tfh, err := req.File(\"avatar\")\n\tif err != nil {\n\t\tt.Fatalf(\"File error: %v\", err)\n\t}\n\tif fh.Filename != \"avatar.png\" {\n\t\tt.Errorf(\"Filename: got %q want %q\", fh.Filename, \"avatar.png\")\n\t}\n}\n"
        }
    ]
}