{
    "sourceFile": "tests/router_test.go",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1772220531061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1772220531061,
            "name": "Commit-0",
            "content": "package routing_test\n\nimport (\n\t\"net/http\"\n\t\"net/http/httptest\"\n\t\"testing\"\n\n\t\"github.com/km-arc/go-laravel/routing\"\n)\n\n// ── helpers ──────────────────────────────────────────────────────────────────\n\nfunc okHandler(w http.ResponseWriter, r *http.Request) {\n\tw.WriteHeader(http.StatusOK)\n\t_, _ = w.Write([]byte(\"ok\"))\n}\n\nfunc do(t *testing.T, router *routing.Router, method, path string) *httptest.ResponseRecorder {\n\tt.Helper()\n\treq := httptest.NewRequest(method, path, nil)\n\trr := httptest.NewRecorder()\n\trouter.ServeHTTP(rr, req)\n\treturn rr\n}\n\n// ── HTTP verbs ────────────────────────────────────────────────────────────────\n\nfunc TestRouter_Get(t *testing.T) {\n\tr := routing.New()\n\tr.Get(\"/hello\", okHandler)\n\n\trr := do(t, r, http.MethodGet, \"/hello\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"GET /hello: got %d want 200\", rr.Code)\n\t}\n}\n\nfunc TestRouter_Post(t *testing.T) {\n\tr := routing.New()\n\tr.Post(\"/users\", okHandler)\n\n\trr := do(t, r, http.MethodPost, \"/users\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"POST /users: got %d want 200\", rr.Code)\n\t}\n}\n\nfunc TestRouter_Put(t *testing.T) {\n\tr := routing.New()\n\tr.Put(\"/users/{id}\", okHandler)\n\n\trr := do(t, r, http.MethodPut, \"/users/1\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"PUT /users/1: got %d want 200\", rr.Code)\n\t}\n}\n\nfunc TestRouter_Patch(t *testing.T) {\n\tr := routing.New()\n\tr.Patch(\"/users/{id}\", okHandler)\n\n\trr := do(t, r, http.MethodPatch, \"/users/1\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"PATCH /users/1: got %d want 200\", rr.Code)\n\t}\n}\n\nfunc TestRouter_Delete(t *testing.T) {\n\tr := routing.New()\n\tr.Delete(\"/users/{id}\", okHandler)\n\n\trr := do(t, r, http.MethodDelete, \"/users/1\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"DELETE /users/1: got %d want 200\", rr.Code)\n\t}\n}\n\nfunc TestRouter_Any(t *testing.T) {\n\tr := routing.New()\n\tr.Any(\"/ping\", okHandler)\n\n\tfor _, method := range []string{\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\"} {\n\t\trr := do(t, r, method, \"/ping\")\n\t\tif rr.Code != http.StatusOK {\n\t\t\tt.Errorf(\"ANY %s /ping: got %d want 200\", method, rr.Code)\n\t\t}\n\t}\n}\n\n// ── 404 for unregistered routes ──────────────────────────────────────────────\n\nfunc TestRouter_NotFound(t *testing.T) {\n\tr := routing.New()\n\trr := do(t, r, http.MethodGet, \"/not-registered\")\n\tif rr.Code != http.StatusNotFound {\n\t\tt.Errorf(\"expected 404, got %d\", rr.Code)\n\t}\n}\n\n// ── Route params ─────────────────────────────────────────────────────────────\n\nfunc TestRouter_Param(t *testing.T) {\n\tr := routing.New()\n\tr.Get(\"/users/{id}\", func(w http.ResponseWriter, req *http.Request) {\n\t\tid := routing.Param(req, \"id\")\n\t\tw.WriteHeader(http.StatusOK)\n\t\t_, _ = w.Write([]byte(id))\n\t})\n\n\trr := do(t, r, http.MethodGet, \"/users/42\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Fatalf(\"got %d want 200\", rr.Code)\n\t}\n\tif rr.Body.String() != \"42\" {\n\t\tt.Errorf(\"got body %q want %q\", rr.Body.String(), \"42\")\n\t}\n}\n\n// ── Prefix / Group ───────────────────────────────────────────────────────────\n\nfunc TestRouter_Prefix(t *testing.T) {\n\tr := routing.New()\n\tr.Prefix(\"/api/v1\", func(api *routing.Router) {\n\t\tapi.Get(\"/users\", okHandler)\n\t})\n\n\trr := do(t, r, http.MethodGet, \"/api/v1/users\")\n\tif rr.Code != http.StatusOK {\n\t\tt.Errorf(\"GET /api/v1/users: got %d want 200\", rr.Code)\n\t}\n\n\t// Root must 404\n\trr2 := do(t, r, http.MethodGet, \"/users\")\n\tif rr2.Code != http.StatusNotFound {\n\t\tt.Errorf(\"GET /users: expected 404, got %d\", rr2.Code)\n\t}\n}\n\nfunc TestRouter_Group_Middleware(t *testing.T) {\n\tcalled := false\n\tmw := func(next http.Handler) http.Handler {\n\t\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\t\t\tcalled = true\n\t\t\tnext.ServeHTTP(w, r)\n\t\t})\n\t}\n\n\tr := routing.New()\n\tr.Group(func(g *routing.Router) {\n\t\tg.Middleware(mw)\n\t\tg.Get(\"/protected\", okHandler)\n\t})\n\n\tdo(t, r, http.MethodGet, \"/protected\")\n\tif !called {\n\t\tt.Error(\"expected middleware to be called\")\n\t}\n}\n\n// ── Resource routes ───────────────────────────────────────────────────────────\n\ntype stubController struct{}\n\nfunc (s *stubController) Index(w http.ResponseWriter, r *http.Request)   { w.WriteHeader(200) }\nfunc (s *stubController) Store(w http.ResponseWriter, r *http.Request)   { w.WriteHeader(201) }\nfunc (s *stubController) Show(w http.ResponseWriter, r *http.Request)    { w.WriteHeader(200) }\nfunc (s *stubController) Update(w http.ResponseWriter, r *http.Request)  { w.WriteHeader(200) }\nfunc (s *stubController) Destroy(w http.ResponseWriter, r *http.Request) { w.WriteHeader(204) }\n\nfunc TestRouter_Resource(t *testing.T) {\n\tr := routing.New()\n\tr.Resource(\"/photos\", &stubController{})\n\n\ttests := []struct {\n\t\tmethod string\n\t\tpath   string\n\t\twant   int\n\t}{\n\t\t{\"GET\", \"/photos\", 200},\n\t\t{\"POST\", \"/photos\", 201},\n\t\t{\"GET\", \"/photos/1\", 200},\n\t\t{\"PUT\", \"/photos/1\", 200},\n\t\t{\"PATCH\", \"/photos/1\", 200},\n\t\t{\"DELETE\", \"/photos/1\", 204},\n\t}\n\n\tfor _, tt := range tests {\n\t\tt.Run(tt.method+\" \"+tt.path, func(t *testing.T) {\n\t\t\trr := do(t, r, tt.method, tt.path)\n\t\t\tif rr.Code != tt.want {\n\t\t\t\tt.Errorf(\"got %d want %d\", rr.Code, tt.want)\n\t\t\t}\n\t\t})\n\t}\n}\n\n// ── Handler() returns http.Handler ───────────────────────────────────────────\n\nfunc TestRouter_HandlerInterface(t *testing.T) {\n\tr := routing.New()\n\tr.Get(\"/ping\", okHandler)\n\tvar _ http.Handler = r.Handler()\n}\n"
        }
    ]
}